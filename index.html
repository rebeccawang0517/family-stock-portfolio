<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;家族股票投資組合管理系統&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const firebaseConfig = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>apiKey: "AIzaSyDo4wM2MkiX-nNyd4zIBSGvedfxVB7Jfb1",</p>
<p class="p1"><span class="Apple-converted-space">            </span>authDomain: "rebecca-financial-platform.firebaseapp.com",</p>
<p class="p1"><span class="Apple-converted-space">            </span>projectId: "rebecca-financial-platform",</p>
<p class="p1"><span class="Apple-converted-space">            </span>storageBucket: "rebecca-financial-platform.firebasestorage.app",</p>
<p class="p1"><span class="Apple-converted-space">            </span>messagingSenderId: "335938745651",</p>
<p class="p1"><span class="Apple-converted-space">            </span>appId: "1:335938745651:web:2c090e33a72db1a5adfa46"</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const allowedEmails = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>'rebecca.chen@gmail.com',</p>
<p class="p1"><span class="Apple-converted-space">            </span>'eric.wang@gmail.com',</p>
<p class="p1"><span class="Apple-converted-space">            </span>'ian.lee@gmail.com'</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const app = initializeApp(firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const auth = getAuth(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const db = getFirestore(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const provider = new GoogleAuthProvider();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.firebaseApp = { auth, db, provider, allowedEmails };</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>@media print {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.no-print { display: none !important; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="loginScreen" class="min-h-screen flex items-center justify-center p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl p-8 max-w-md w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1 class="text-3xl font-bold text-slate-100 mb-2 text-center"&gt;家族股票管理系統&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-slate-400 text-center mb-8"&gt;Professional Portfolio Management&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button onclick="loginWithGoogle()" class="w-full bg-white hover:bg-gray-100 text-gray-900 font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-3 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-6 h-6" viewBox="0 0 24 24"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>使用 Google 帳號登入</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm text-slate-400 text-center"&gt;僅限 Rebecca、Eric、Ian 使用&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="mainApp" class="hidden p-4 md:p-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="max-w-7xl mx-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg shadow-2xl p-6 mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center justify-between flex-wrap gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h1 class="text-3xl font-bold text-slate-100 mb-2"&gt;家族股票投資組合管理系統&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p class="text-slate-400"&gt;已登入：&lt;span id="userEmail" class="text-blue-400"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3 flex-wrap no-print"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>📥 匯出 Excel</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button onclick="window.print()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>🖨️ 列印</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button onclick="logout()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>登出</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl p-4 mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center justify-between"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-slate-300 font-medium"&gt;匯率 USD/TWD&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="usdRate" value="31.5" step="0.01" class="bg-slate-700 text-slate-100 px-3 py-1 rounded border border-slate-600 focus:border-blue-500 focus:outline-none w-24 text-right font-mono" onchange="updateStats()" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-slate-400 text-sm mb-1"&gt;總投資成本&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="totalCost" class="text-2xl font-bold text-slate-100"&gt;TWD 0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-slate-400 text-sm mb-1"&gt;總市值&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="totalValue" class="text-2xl font-bold text-slate-100"&gt;TWD 0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-slate-400 text-sm mb-1"&gt;總損益&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="totalProfit" class="text-2xl font-bold"&gt;TWD 0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="text-slate-400 text-sm mb-1"&gt;總報酬率&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="totalReturn" class="text-2xl font-bold"&gt;0%&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="overflow-x-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;table class="w-full text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr class="bg-slate-900 border-b border-slate-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-left text-slate-300"&gt;地區&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-left text-slate-300"&gt;公司&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-left text-slate-300"&gt;代號&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;成本價&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;股數&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;投資成本&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;現價&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;現值&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-right text-slate-300"&gt;報酬率&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-left text-slate-300"&gt;持有人&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-left text-slate-300"&gt;平台&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;th class="px-3 py-3 text-center text-slate-300 no-print"&gt;操作&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;tbody id="stockTableBody"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr class="bg-blue-900 bg-opacity-20 border-b-2 border-blue-500 no-print"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;select id="newRegion" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;台股&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;美股&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="text" id="newCompany" placeholder="公司名稱" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="text" id="newSymbol" placeholder="代號" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm font-mono" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2 text-slate-500 text-right text-xs"&gt;自動&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="number" id="newShares" placeholder="股數" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm text-right" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="number" id="newCost" placeholder="成本" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm text-right" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;input type="number" id="newPrice" placeholder="現價" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm text-right" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2 text-slate-500 text-right text-xs"&gt;自動&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2 text-slate-500 text-right text-xs"&gt;自動&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;select id="newHolder" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option value=""&gt;選擇&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;Rebecca&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;Eric&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;Ian&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;select id="newPlatform" class="w-full bg-slate-700 text-slate-100 px-2 py-1.5 rounded border border-slate-600 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;付委托&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;option&gt;信託&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td class="px-3 py-2 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;button onclick="addStock()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded"&gt;新增&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="mt-6 bg-blue-900 bg-opacity-30 border border-blue-700 border-opacity-50 rounded-lg p-4 text-sm text-blue-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;strong&gt;💡 使用說明：&lt;/strong&gt; 資料即時同步雲端，Rebecca、Eric、Ian 都能查看和編輯</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const { auth, db, provider, allowedEmails } = window.firebaseApp;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let currentUser = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let stocks = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>import { onAuthStateChanged, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { collection, onSnapshot, addDoc, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>onAuthStateChanged(auth, async (user) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (user &amp;&amp; allowedEmails.includes(user.email)) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentUser = user;</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('loginScreen').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('mainApp').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('userEmail').textContent = user.email;</p>
<p class="p1"><span class="Apple-converted-space">                </span>await loadStocks();</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (user) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('您的帳號無權訪問此系統');</p>
<p class="p1"><span class="Apple-converted-space">                </span>await auth.signOut();</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('loginScreen').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('mainApp').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.loginWithGoogle = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>await signInWithPopup(auth, provider);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('登入失敗：' + error.message);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.logout = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (confirm('確定要登出嗎？')) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>await auth.signOut();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function loadStocks() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const stocksRef = collection(db, 'stocks');</p>
<p class="p1"><span class="Apple-converted-space">            </span>onSnapshot(stocksRef, (snapshot) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>stocks = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>snapshot.forEach((doc) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stocks.push({ id: doc.id, ...doc.data() });</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderStocks();</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function renderStocks() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tbody = document.getElementById('stockTableBody');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const addRow = tbody.querySelector('tr');</p>
<p class="p1"><span class="Apple-converted-space">            </span>tbody.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>tbody.appendChild(addRow);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>stocks.forEach(stock =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const calc = calculateFields(stock);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const tr = document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">                </span>tr.className = 'border-b border-slate-700 hover:bg-slate-750';</p>
<p class="p1"><span class="Apple-converted-space">                </span>tr.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-slate-300"&gt;${stock.region}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-slate-300"&gt;${stock.companyName}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-slate-100 font-mono font-semibold"&gt;${stock.symbol}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right text-slate-300 font-mono text-xs"&gt;${calc.costPrice.toFixed(2)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right text-slate-300 font-mono"&gt;${stock.shares.toLocaleString()}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right text-slate-300 font-mono text-xs"&gt;${stock.investmentCost.toLocaleString()}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right text-slate-300 font-mono text-xs"&gt;${stock.currentPrice.toFixed(2)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right text-slate-300 font-mono text-xs"&gt;${calc.currentValue.toLocaleString()}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-right font-mono font-semibold ${calc.returnRate &gt;= 0 ? 'text-green-400' : 'text-red-400'}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>${calc.returnRate &gt;= 0 ? '+' : ''}${calc.returnRate.toFixed(2)}%</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-slate-300"&gt;${stock.holder}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-slate-300"&gt;${stock.platform}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;td class="px-3 py-3 text-center no-print"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button onclick="deleteStock('${stock.id}')" class="text-red-400 hover:text-red-300"&gt;🗑️&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>tbody.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function calculateFields(stock) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const usdRate = parseFloat(document.getElementById('usdRate').value) || 31.5;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const shares = parseFloat(stock.shares) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const investmentCost = parseFloat(stock.investmentCost) || 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentPrice = parseFloat(stock.currentPrice) || 0;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const costPrice = shares &gt; 0 ? investmentCost / shares : 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentValue = currentPrice * shares;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const returnRate = investmentCost &gt; 0 ? ((currentValue - investmentCost) / investmentCost) * 100 : 0;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentValueTWD = stock.region === '美股' ? currentValue * usdRate : currentValue;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const investmentCostTWD = stock.region === '美股' ? investmentCost * usdRate : investmentCost;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>return { costPrice, currentPrice, currentValue, currentValueTWD, investmentCostTWD, returnRate };</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.updateStats = function() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const usdRate = parseFloat(document.getElementById('usdRate').value) || 31.5;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let totalCost = 0, totalValue = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>stocks.forEach(stock =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const calc = calculateFields(stock);</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalCost += calc.investmentCostTWD;</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalValue += calc.currentValueTWD;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const profit = totalValue - totalCost;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const returnRate = totalCost &gt; 0 ? ((totalValue - totalCost) / totalCost) * 100 : 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalCost').textContent = 'TWD ' + totalCost.toLocaleString(undefined, {maximumFractionDigits: 0});</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalValue').textContent = 'TWD ' + totalValue.toLocaleString(undefined, {maximumFractionDigits: 0});</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalProfit').textContent = 'TWD ' + profit.toLocaleString(undefined, {maximumFractionDigits: 0});</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalProfit').className = 'text-2xl font-bold ' + (profit &gt;= 0 ? 'text-green-400' : 'text-red-400');</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalReturn').textContent = (returnRate &gt;= 0 ? '+' : '') + returnRate.toFixed(2) + '%';</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('totalReturn').className = 'text-2xl font-bold ' + (returnRate &gt;= 0 ? 'text-green-400' : 'text-red-400');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.addStock = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const region = document.getElementById('newRegion').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const companyName = document.getElementById('newCompany').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const symbol = document.getElementById('newSymbol').value.toUpperCase();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const shares = parseFloat(document.getElementById('newShares').value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const investmentCost = parseFloat(document.getElementById('newCost').value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentPrice = parseFloat(document.getElementById('newPrice').value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const holder = document.getElementById('newHolder').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const platform = document.getElementById('newPlatform').value;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!symbol || !shares || !investmentCost || !currentPrice || !holder) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('請填寫所有必填欄位');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>await addDoc(collection(db, 'stocks'), {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>region, companyName, symbol, shares, investmentCost, currentPrice, holder, platform,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>createdAt: new Date().toISOString(),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>createdBy: currentUser.email</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newCompany').value = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newSymbol').value = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newShares').value = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newCost').value = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newPrice').value = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('newHolder').value = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('新增失敗：' + error.message);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.deleteStock = async (id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!confirm('確定要刪除嗎？')) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>await deleteDoc(doc(db, 'stocks', id));</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('刪除失敗：' + error.message);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>window.exportToExcel = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const data = stocks.map(stock =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const calc = calculateFields(stock);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>地區: stock.region,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>公司名稱: stock.companyName,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>股票代號: stock.symbol,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>成本股價: calc.costPrice.toFixed(2),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>股數: stock.shares,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>投資成本: stock.investmentCost,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>現價: stock.currentPrice,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>現值: calc.currentValue.toFixed(2),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>報酬率: calc.returnRate.toFixed(2) + '%',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>持有人: stock.holder,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>持有平台: stock.platform</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const ws = XLSX.utils.json_to_sheet(data);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const wb = XLSX.utils.book_new();</p>
<p class="p1"><span class="Apple-converted-space">            </span>XLSX.utils.book_append_sheet(wb, ws, '投資組合');</p>
<p class="p1"><span class="Apple-converted-space">            </span>XLSX.writeFile(wb, `投資組合_${new Date().toISOString().split('T')[0]}.xlsx`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
